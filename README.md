# Certen Proofs Service

A standalone service for storing, retrieving, and exploring Certen cryptographic proof artifacts.

## Overview

The Certen Proofs Service provides infrastructure for managing proof artifacts generated by the Certen Protocol validator network. It serves as the canonical storage and retrieval layer for:

- **Proof Artifacts**: 4-component cryptographic proofs (Merkle inclusion, anchor reference, chained proofs, governance proofs)
- **Proof Bundles**: Self-contained verification packages
- **Custody Chain**: Complete audit trail of proof lifecycle events
- **Attestations**: Multi-validator signatures on proof validity

## Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                    Certen Proofs Service                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────────┐     ┌─────────────────┐                   │
│   │  Proof Explorer │     │    REST API     │                   │
│   │   (React UI)    │────▶│   (Go/HTTP)     │                   │
│   │   Port 3000     │     │   Port 8080     │                   │
│   └─────────────────┘     └────────┬────────┘                   │
│                                    │                             │
│                           ┌────────▼────────┐                   │
│                           │   PostgreSQL    │                   │
│                           │   Port 5432     │                   │
│                           └─────────────────┘                   │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## Components

| Component | Description |
|-----------|-------------|
| **REST API** | Go HTTP service for proof discovery, retrieval, and verification |
| **PostgreSQL** | Proof artifact storage with full audit trail |
| **Proof Explorer** | React web UI for browsing and inspecting proofs |

## Quick Start

### Using Docker Compose (Recommended)

```bash
# Clone the repository
git clone https://github.com/certenIO/certen-proofs-service.git
cd certen-proofs-service

# Copy environment template
cp .env.example .env

# Start all services
docker-compose up -d

# Access the services
# - Proof Explorer: http://localhost:3000
# - API: http://localhost:8080
# - Health Check: http://localhost:8080/health
```

### Manual Setup

```bash
# Start PostgreSQL and run migrations
psql -U postgres -c "CREATE DATABASE certen_proofs;"
for f in pkg/database/migrations/*.sql; do
  psql -U postgres -d certen_proofs -f "$f"
done

# Build and run the API service
go build -o proof-service ./cmd/proof-service
DATABASE_URL="postgres://user:pass@localhost:5432/certen_proofs?sslmode=disable" \
DEVELOPMENT_MODE=true \
./proof-service

# Build and run the Proof Explorer (separate terminal)
cd web/proof-explorer
npm install
npm run dev
```

## API Reference

### Proof Discovery

| Method | Endpoint | Description |
|--------|----------|-------------|
| `GET` | `/api/v1/proofs/tx/{hash}` | Get proof by Accumulate transaction hash |
| `GET` | `/api/v1/proofs/{proof_id}` | Get proof by ID with full details |
| `GET` | `/api/v1/proofs/account/{url}` | List proofs by account URL (paginated) |
| `GET` | `/api/v1/proofs/batch/{batch_id}` | Get all proofs in a batch |
| `GET` | `/api/v1/proofs/anchor/{tx_hash}` | Get proofs by anchor transaction |
| `POST` | `/api/v1/proofs/query` | Query proofs with filters |

### Proof Bundles

| Method | Endpoint | Description |
|--------|----------|-------------|
| `GET` | `/api/v1/proofs/{proof_id}/bundle` | Download self-contained proof bundle |
| `GET` | `/api/v1/proofs/{proof_id}/bundle/verify` | Verify bundle integrity and components |
| `GET` | `/api/v1/proofs/{proof_id}/custody` | Get custody chain events |

### Proof Requests

| Method | Endpoint | Description |
|--------|----------|-------------|
| `POST` | `/api/v1/proofs/request` | Request new proof generation |
| `GET` | `/api/v1/proofs/request/{request_id}` | Get request status |

### Verification

| Method | Endpoint | Description |
|--------|----------|-------------|
| `POST` | `/api/v1/proofs/verify/merkle` | Verify Merkle inclusion proof |
| `POST` | `/api/v1/proofs/verify/governance` | Verify governance proof (G0/G1/G2) |

### System

| Method | Endpoint | Description |
|--------|----------|-------------|
| `GET` | `/health` | Health check endpoint |

## Configuration

### Environment Variables

| Variable | Default | Description |
|----------|---------|-------------|
| `DATABASE_URL` | - | PostgreSQL connection string (required) |
| `API_PORT` | `8080` | API server port |
| `API_HOST` | `0.0.0.0` | API server host |
| `SERVICE_ID` | `proof-service-1` | Service identifier |
| `LOG_LEVEL` | `info` | Logging level (debug, info, warn, error) |
| `CORS_ORIGINS` | `http://localhost:3000` | Allowed CORS origins (comma-separated) |
| `API_KEY_REQUIRED` | `false` | Require API keys for access |
| `RATE_LIMIT_REQUESTS` | `100` | Requests per minute per client |
| `DEVELOPMENT_MODE` | `false` | Enable relaxed validation |

### Database Migrations

The service uses 5 migration files to set up the PostgreSQL schema:

| Migration | Description |
|-----------|-------------|
| `001_initial_schema.sql` | Core tables (batches, transactions, anchors, proofs) |
| `002_comprehensive_proof_schema.sql` | Extended metadata, multi-validator attestations |
| `003_proof_service_enhancements.sql` | Bundles, pricing tiers, custody chain, API keys |
| `004_level4_execution_proof.sql` | Level 4 execution proofs, external chain tracking |
| `005_anchor_proof_enhancements.sql` | Extended anchor metadata, cross-chain commitments |

## Project Structure

```
certen-proofs-service/
├── cmd/
│   └── proof-service/          # API service entrypoint
│       └── main.go
├── pkg/
│   ├── config/                 # Configuration management
│   │   └── config.go
│   ├── database/               # PostgreSQL layer
│   │   ├── migrations/         # SQL schema migrations
│   │   ├── client.go           # DB connection & pooling
│   │   ├── repositories.go     # Repository factory
│   │   ├── types.go            # Database models
│   │   ├── proof_artifact_*.go # Proof artifact storage
│   │   └── repository_*.go     # Domain repositories
│   └── server/                 # HTTP API handlers
│       ├── proof_handlers.go   # Discovery endpoints
│       ├── bundle_handlers.go  # Bundle/verification endpoints
│       └── bulk_handlers.go    # Bulk export endpoints
├── web/
│   └── proof-explorer/         # React frontend
│       ├── src/
│       │   ├── api/            # API client
│       │   ├── components/     # React components
│       │   └── pages/          # Page components
│       ├── Dockerfile
│       └── package.json
├── docs/                       # Documentation
├── docker-compose.yml          # Full stack deployment
├── Dockerfile                  # API service container
├── go.mod                      # Go module definition
├── .env.example                # Configuration template
├── .gitignore
└── README.md
```

## Development

### Prerequisites

- Go 1.21+
- Node.js 18+
- PostgreSQL 15+
- Docker & Docker Compose (optional)

### Building

```bash
# Build API service
go build -o proof-service ./cmd/proof-service

# Build frontend
cd web/proof-explorer
npm install
npm run build
```

### Testing

```bash
# Run Go tests
go test ./...

# Run frontend tests
cd web/proof-explorer
npm test
```

### Running Locally

```bash
# Terminal 1: Start PostgreSQL
docker run -d \
  --name certen-postgres \
  -e POSTGRES_USER=certen \
  -e POSTGRES_PASSWORD=certen \
  -e POSTGRES_DB=certen_proofs \
  -p 5432:5432 \
  postgres:15-alpine

# Terminal 2: Run API service
DATABASE_URL="postgres://certen:certen@localhost:5432/certen_proofs?sslmode=disable" \
DEVELOPMENT_MODE=true \
go run ./cmd/proof-service

# Terminal 3: Run frontend
cd web/proof-explorer
VITE_API_URL=http://localhost:8080 npm run dev
```

## Proof Bundle Format

The service stores and serves proof bundles in the `CertenProofBundle v1.0` format:

```json
{
  "$schema": "https://certen.io/schemas/proof-bundle/v1.0",
  "bundle_version": "1.0",
  "bundle_id": "uuid",
  "generated_at": "ISO-8601",

  "transaction_reference": {
    "accum_tx_hash": "64-char-hex",
    "account_url": "acc://...",
    "transaction_type": "..."
  },

  "proof_components": {
    "1_merkle_inclusion": { ... },
    "2_anchor_reference": { ... },
    "3_chained_proof": { ... },
    "4_governance_proof": { ... }
  },

  "validator_attestations": [ ... ],
  "bundle_integrity": { ... }
}
```

## Related Projects

- [Certen Protocol](https://github.com/certenIO/certen-protocol) - Core protocol implementation
- [Accumulate](https://accumulate.network) - Identity-based blockchain

## License

Copyright 2025 Certen Protocol. All rights reserved.
